<nz-tag
  [nzColor]="nzColor"
  [ngClass]="{ muted: muted() }"
  [nz-popover]="!isMobileView() && mode() !== 'inline' ? licenseContent : undefined"
  [nzPopoverTitle]="!isMobileView() && mode() !== 'inline' ? licenseFullTitle : undefined"
  [nzPopoverContent]="!isMobileView() && mode() !== 'inline' ? licenseContent : undefined"
  nzPopoverTrigger="hover"
  role="button"
  aria-expanded="{{ expanded() }}"
  aria-label="License info"
  (click)="handleTagClick()"
>
  <span class="tag-label">
    <i class="bx bx-info-circle tag-icon" aria-hidden="true"></i>
    <span>{{ licenseTitle }}</span>
    @if (mode() === 'inline') {
      <i
        class="bx toggle-icon"
        [ngClass]="expanded() ? 'bx-chevron-up' : 'bx-chevron-down'"
        aria-hidden="true"
      ></i>
    }
  </span>
</nz-tag>

@if (mode() === 'inline' && expanded()) {
  <div class="inline-details" role="region" aria-label="License details">
    <ng-container *ngTemplateOutlet="licenseContent"></ng-container>
  </div>
}

@if (isMobileView() && mode() !== 'inline') {
  <nz-drawer
    [nzVisible]="showPopover()"
    [nzTitle]="licenseFullTitle"
    nzPlacement="bottom"
    nzHeight="auto"
    role="dialog"
    aria-modal="true"
    (nzOnClose)="showPopover.set(false)"
  >
    <ng-container *nzDrawerContent>
      <ng-container *ngTemplateOutlet="licenseContent"></ng-container>
    </ng-container>
  </nz-drawer>
}

<ng-template #licenseContent>
  <div class="license-content">
    <p class="license-description">{{ description }}</p>
    <a
      [href]="getLicenseUrl(license())"
      target="_blank"
      rel="noopener noreferrer"
      class="license-link"
      role="link"
      aria-label="Learn more about {{ licenseTitle }}"
    >
      <i class="bx bx-arrow-out-up-left-stroke-square" aria-hidden="true"></i>
      <span>{{ LearnMoreText }}</span>
    </a>
  </div>
</ng-template>
